# YouTube Analyzer MCP

MCP server for YouTube video analysis and content optimization based on high-performing videos.

## Overview

This MCP (Model Context Protocol) server was generated by KEN-MCP based on the following requirements:

> Create a YouTube analysis MCP server that takes a video idea as input and returns 10 high-performing video titles with their thumbnails. The server should:

1. Accept a video idea (e.g., "video automation") as input
2. Use YouTube Data API v3 to search for related videos
3. Apply semantic search to find broader relevant content beyond exact matches
4. Filter results to only include videos from the last 30 days maximum
5. Only consider high-performing videos (configurable minimum view count thresholds)
6. Manage API quota efficiently (YouTube allows 10,000 units/day)
7. Extract thumbnail URLs using both API and direct URL patterns
8. Rank results by performance metrics (views, engagement, recency)
9. Return top 10 results with: title, thumbnail URL, performance metrics, publish date
10. Provide tools for video idea analysis and title/thumbnail recommendations

The goal is to help content creators find proven, successful title and thumbnail combinations from recent high-performing videos that they can adapt for their own content ideas.

## Features

### Tools (3)
- **analyze_video_idea**: Analyze a video idea and find high-performing related videos with titles and thumbnails
- **get_quota_status**: Check current YouTube API quota usage
- **expand_search_terms**: Generate semantic variations of a video idea for broader search

### Production Enhancements ✨
- ✅ **Comprehensive Error Handling**: Graceful handling of API failures, network errors, and edge cases
- ✅ **Input Validation**: Robust validation against malicious input, size limits, and data integrity
- ✅ **Intelligent Caching**: 15-30 minute caching for API responses to reduce quota usage
- ✅ **Rate Limiting**: Built-in rate limiting to prevent API abuse (50 requests/minute)
- ✅ **Quota Management**: Real-time tracking of YouTube API quota usage with alerts
- ✅ **Performance Monitoring**: Detailed logging and performance metrics tracking
- ✅ **Security Features**: SQL injection prevention, XSS protection, input sanitization
- ✅ **Production Logging**: Structured logging with timestamps and context
- ✅ **Memory Management**: LRU cache with size limits and automatic cleanup

### Resources (5)
- **Analysis History** (`youtube://analysis-history`): History of video idea analyses performed
- **Quota Status** (`youtube://quota-status`): Current YouTube API quota usage and limits
- **Trending Topics** (`youtube://trending-topics`): Currently trending video topics and keywords
- **Performance Metrics** (`youtube://performance-metrics`): Server performance and analysis statistics
- **Configuration** (`config://settings`): Server configuration and API settings

### Prompts (5)
- **analyze_data**: Analyze data data and provide insights
- **analyze_search**: Analyze search data and provide insights
- **analyze_content**: Analyze content data and provide insights
- **analyze_goal**: Analyze goal data and provide insights
- **help**: Get help with using this MCP server


## Installation

### Prerequisites

- Node.js 16 or higher
- npm or yarn
- YouTube Data API v3 key
- MCP Auth Token

### Environment Variables

Create a `.env` file with:

```bash
YOUTUBE_API_KEY=your-youtube-api-key
MCP_AUTH_TOKEN=your-secure-mcp-auth-token
PORT=8080
```

### Setup

1. Clone this repository
2. Install dependencies:
   ```bash
   npm install
   ```

3. Build the project:
   ```bash
   npm run build
   ```

## Usage

### Production SSE Server (Railway/Docker)

The server runs as an authenticated SSE server:

```bash
node dist/sse-server.js
```

**Endpoints:**
- `GET /sse` - SSE endpoint for n8n (requires Bearer token)
- `POST /messages` - JSON-RPC messages (requires Bearer token)

**Authentication:**
All endpoints require `Authorization: Bearer YOUR_MCP_AUTH_TOKEN` header.

### Development Mode (Local Testing)

Run the stdio server for local development:

```bash
npm run dev
# or
node dist/index.js
```

### Adding to n8n

Connect to your deployed MCP server using:
- **SSE URL**: `https://your-railway-app.railway.app/sse`
- **Bearer Token**: Your `MCP_AUTH_TOKEN`

## API Reference

### Tools

#### analyze_video_idea

Analyze a video idea and find high-performing related videos with titles and thumbnails

**Parameters:**
- `videoIdea` (string, required): The video idea to analyze (e.g., "video automation")
- `minViewCount` (number, optional): Minimum view count for videos to consider (default: 10000)
- `maxResults` (number, optional): Maximum number of results to return (default: 10)
- `youtubeApiKey` (string, required): YouTube Data API key

**Example:**
```json
{
  "videoIdea": "video automation",
  "minViewCount": 50000,
  "maxResults": 5,
  "youtubeApiKey": "YOUR_API_KEY"
}
```

#### get_quota_status

Check current YouTube API quota usage

**Parameters:** None

**Returns:** Current quota usage information including remaining quota and reset date

#### expand_search_terms

Generate semantic variations of a video idea for broader search

**Parameters:**
- `videoIdea` (string, required): The video idea to expand

**Example:**
```json
{
  "videoIdea": "video automation"
}
```

#### get_performance_metrics

Get detailed performance metrics and analytics

**Parameters:** None

**Returns:** Comprehensive metrics including:
- API request statistics (total, successful, failed, cached)
- Performance metrics (average response time, slowest/fastest requests)
- Error tracking by type
- Quota usage breakdown
- Cache hit rates and success rates
- System metrics (memory usage, uptime, circuit breaker state)

**Example Response:**
```json
{
  "apiMetrics": {
    "requests": {
      "total": 150,
      "successful": 145,
      "failed": 2,
      "cached": 3
    },
    "cacheHitRate": 2.0,
    "successRate": 98.67
  },
  "systemMetrics": {
    "uptime": "2h 15m 30s",
    "circuitBreakerState": "closed",
    "memoryUsage": {
      "heapUsed": 45.23,
      "heapTotal": 128.50
    }
  }
}
```


### Resources

#### data List

- **URI**: `data://list`
- **Type**: application/json
- **Description**: List of all datas

#### search List

- **URI**: `search://list`
- **Type**: application/json
- **Description**: List of all searchs

#### content List

- **URI**: `content://list`
- **Type**: application/json
- **Description**: List of all contents

#### goal List

- **URI**: `goal://list`
- **Type**: application/json
- **Description**: List of all goals

#### Configuration

- **URI**: `config://settings`
- **Type**: application/json
- **Description**: Server configuration and settings


### Prompts

#### analyze_data

Analyze data data and provide insights

**Arguments:**
- `context` (optional): Analysis context

#### analyze_search

Analyze search data and provide insights

**Arguments:**
- `context` (optional): Analysis context

#### analyze_content

Analyze content data and provide insights

**Arguments:**
- `context` (optional): Analysis context

#### analyze_goal

Analyze goal data and provide insights

**Arguments:**
- `context` (optional): Analysis context

#### help

Get help with using this MCP server




## Testing

Run the test suite:

```bash
npm test
```

Run tests in watch mode:

```bash
npm run test:watch
```

## Development

### Project Structure

```
.
├── src/
│   ├── index.ts      # Main server entry point
│   ├── tools.ts      # Tool implementations
│   ├── resources.ts  # Resource implementations
│   ├── prompts.ts    # Prompt definitions
│   └── types.ts      # TypeScript type definitions
├── test/
│   └── server.test.ts # Test suite
├── package.json
├── tsconfig.json
└── README.md
```

### Extending the Server

1. **Adding Tools**: Edit `src/tools.ts` to add new tool handlers
2. **Adding Resources**: Edit `src/resources.ts` to add new resource handlers
3. **Adding Prompts**: Edit `src/prompts.ts` to add new prompt templates

## License

MIT

---

Generated with ❤️ by KEN-MCP TypeScript
